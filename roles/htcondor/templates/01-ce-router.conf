
###############################################################################
#
# HTCondor-CE JobRouter configuration
#
# This file will NOT be overwritten upon RPM upgrade.
#
###############################################################################

# Set the maximum number of jobs the CE is willing to run.
CONDORCE_MAX_JOBS = 10000


# Set the max time, in minutes, of routed jobs (default 72 hours)
ROUTED_JOB_MAX_TIME = 4320


# The amount of time, in seconds, that the job router will wait before considering
# new candidate jobs for routing. If you are seeing heavy CPU usage from the job
# router, increase the polling period to a few hundred seconds.
# JOB_ROUTER_POLLING_PERIOD = 10


# Set this to True to allow HTCondor-CE jobs to run more than once
# (default: False)
# ENABLE_JOB_RETRIES = False


# Some pilot systems leave completed jobs in the HTCondor-CE queue for
# VO operators to retrieve later to troubleshoot specific pilot jobs.
# Set this to the maximum number of days that completed jobs may
# remain in the queue after completion.
# (default: 30)
# COMPELTED_JOB_EXPIRATION = 30


# Use the defaults generated by the condor_ce_router_defaults script.  To add
# additional defaults, add additional lines of the form:
#
#   JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS) [set_foo = 1;]
#
MERGE_JOB_ROUTER_DEFAULT_ADS=True
#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# Warning: JOB_ROUTER_DEFAULTS, JOB_ROUTER_ENTRIES, JOB_ROUTER_ENTRIES_CMD, and
#          JOB_ROUTER_ENTRIES_FILE are deprecated and will be removed for V24 of
#          the HTCondor Software Suite. New configuration syntax for the job router is defined using
#          JOB_ROUTER_ROUTE_NAMES and JOB_ROUTER_ROUTE_<name>. For new syntax example visit:
# https://htcondor.readthedocs.io/en/latest/grid-computing/job-router.html#an-example-configuration
#   Note: The removal will occur during the lifetime of the HTCondor V23 feature series.
#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS_GENERATED)


# Set the JobRouter configuration syntax, defaults to True
# (i.e. JOB_ROUTER_DEFAULTS combined with JOB_ROUTER_ENTRIES).
# Set to 'False' to use the new 'JOB_ROUTER_TRANSFORM_*' and 'JOB_ROUTER_ROUTE_*'
# style configuration (requires HTCondor 8.9)
#
# JOB_ROUTER_USE_DEPRECATED_ROUTER_ENTRIES = True
JOB_ROUTER_SCHEDD2_POOL = {{ htcondor_fqdn }}:9618

JOB_ROUTER_USE_DEPRECATED_ROUTER_ENTRIES = False

JOB_ROUTER_ROUTE_atlas_sam @=jrt
  REQUIREMENTS (x509UserProxyVoName =?= "atlas" && x509UserProxyFirstFQAN =?= "/atlas/Role=lcgadmin/Capability=NULL") ||\
 (AuthTokenIssuer =?= "https://atlas-auth.web.cern.ch/" &&\
 AuthTokenSubject =?= "c3a22a4c-8257-1abf-562c-4c15e8fac421")
  UNIVERSE VANILLA
  SET Requirements (TARGET.t1_allow_sam =?= true) && (!StringListMember("gpfs_atlas",t1_GPFS_CHECK ?: "",":"))
  SET MaxJobs 35
  SET MaxIdleJobs 12
@jrt

JOB_ROUTER_ROUTE_atlas @=jrt
  REQUIREMENTS (((x509UserProxyVoName =?= "atlas") ||\
 (AuthTokenIssuer =?= "https://atlas-auth.web.cern.ch/" &&\
 StringListMember(AuthTokenSubject ?: "",\
 "7dee38a3-6ab8-4fe2-9e4c-123abc82f732:642c5236-548b-2ad1-3b42-6fab13b21f03", ":"))) && (iRqueue == "atlas"))
  UNIVERSE VANILLA
  SET Requirements (!StringListMember("gpfs_atlas",t1_GPFS_CHECK ?: "",":")) && (t1_allow_sam =!= true)
  SET MaxJobs 3500
  SET MaxIdleJobs 1280
@jrt

#JOB_ROUTER_ROUTE_atlas_ce @=jrt
#  REQUIREMENTS queue == "UKI-SCOTGRID-ECDF_TEST"
#  UNIVERSE VANILLA
#  SET Requirements (group_name == "condor-ce-test") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
#  SET MaxJobs 3500
#  SET MaxIdleJobs 1280
#@jrt

#JOB_ROUTER_ROUTE_atlas_ecdf @=jrt
#  REQUIREMENTS queue == "UKI-SCOTGRID-ECDF_CLOUD"
#  UNIVERSE VANILLA
#  SET Requirements (group_name == "new-atlas") && (target_alias == "uki-scotgrid-ecdf_cloud") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
#  SET MaxJobs 3500
#  SET MaxIdleJobs 1280
#@jrt


JOB_ROUTER_ROUTE_atlas_ecdf @=jrt
  REQUIREMENTS queue == "UKI-SCOTGRID-ECDF_CLOUD"
  UNIVERSE VANILLA
  SET Requirements (group_name == "atlas-uk") && (target_alias == "uki-scotgrid-ecdf_cloud") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
  SET MaxJobs 3500
  SET MaxIdleJobs 1280
@jrt

#JOB_ROUTER_ROUTE_atlas_hephy_uibk @=jrt
#  REQUIREMENTS queue == "hephy-uibk"
#  UNIVERSE VANILLA
#  SET Requirements (group_name == "new-atlas") && (target_alias == "hephy-uibk") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
#  SET MaxJobs 3500
#  SET MaxIdleJobs 1280
#@jrt

JOB_ROUTER_ROUTE_atlas_cern_extension @=jrt
  REQUIREMENTS queue == "cern-extension"
  UNIVERSE VANILLA
  SET Requirements (group_name == "new-atlas") && (target_alias == "cern-extension") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
  SET MaxJobs 3500
  SET MaxIdleJobs 1280
@jrt

JOB_ROUTER_ROUTE_atlas_uvic @=jrt
  REQUIREMENTS queue == "CA-IAAS-T3"
  UNIVERSE VANILLA
  SET Requirements (group_name == "atlas-uvic") && (target_alias == "ca-iaas-t3") && (TARGET.Cpus >= RequestCpus) && (TARGET.Memory >= RequestMemory) && (TARGET.HasFileTransfer)
  SET MaxJobs 3500
  SET MaxIdleJobs 1280
@jrt

#JOB_ROUTER_ROUTE_NAMES = atlas_sam atlas atlas_ecdf atlas_hephy_uibk atlas_cern_extension atlas_uvic
JOB_ROUTER_ROUTE_NAMES = atlas_sam atlas atlas_ecdf atlas_cern_extension atlas_uvic

